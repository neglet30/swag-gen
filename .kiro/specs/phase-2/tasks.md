# Phase 2: 核心功能 - 任务清单

## 任务概览

Phase 2 包含 5 个主要任务，共 18 个子任务。预计完成时间为 2 周。

---

## 1. 代码解析模块实现

### 1.1 创建解析器基础结构
- [x] 创建 `pkg/parser/` 目录
- [x] 创建 `pkg/parser/models.go` 定义数据模型
- [x] 创建 `pkg/parser/parser.go` 主解析器
- [x] 定义 Parser 结构体和接口
- [x] 实现 NewParser 构造函数

### 1.2 实现 AST 解析
- [x] 创建 `pkg/parser/ast_parser.go`
- [x] 实现文件扫描功能
- [x] 实现 go/parser 集成
- [x] 实现递归目录扫描
- [x] 实现并发文件解析
- [x] 实现错误处理和恢复

### 1.3 实现注释解析
- [x] 创建 `pkg/parser/comment_parser.go`
- [x] 实现注释提取
- [x] 实现 Swagger 标签识别
- [x] 实现标签值提取
- [x] 实现标签格式验证
- [x] 支持所有标准标签

### 1.4 实现 API 信息提取
- [x] 实现路由信息提取
- [ ] 完善参数信息提取（当前仅支持基本格式）
- [ ] 完善响应信息提取（当前仅支持基本格式）
- [ ] 实现数据模型识别
- [ ] 实现信息验证

### 1.5 编写解析器测试
- [x] 创建 `pkg/parser/parser_test.go`
- [x] 创建 `pkg/parser/ast_parser_test.go`
- [x] 创建 `pkg/parser/comment_parser_test.go`
- [x] 编写单元测试用例
- [x] 编写集成测试用例
- [ ] 验证测试覆盖率 > 80%

---

## 2. Swagger 生成模块实现

### 2.1 创建 Swagger 生成器基础结构
- [x] 创建 `pkg/swagger/` 目录
- [x] 创建 `pkg/swagger/models.go` 定义 OpenAPI 模型
- [x] 创建 `pkg/swagger/builder.go` 主构建器
- [x] 定义 Builder 结构体和接口
- [x] 实现 NewBuilder 构造函数

### 2.2 实现文档构建
- [x] 实现 OpenAPI 3.0 文档结构创建
- [x] 实现基本信息设置
- [x] 实现路径和操作添加
- [x] 实现响应定义
- [x] 实现参数定义

### 2.3 实现 Schema 生成
- [x] 创建 `pkg/swagger/schema_builder.go`
- [x] 实现基本类型 Schema 生成
- [x] 实现结构体 Schema 生成
- [x] 实现数组 Schema 生成
- [x] 实现嵌套结构处理
- [x] 实现指针类型处理

### 2.4 实现格式转换
- [x] 实现 JSON 格式输出
- [x] 实现 YAML 格式输出
- [x] 实现格式验证
- [x] 实现格式优化

### 2.5 编写 Swagger 生成器测试
- [x] 创建 `pkg/swagger/builder_test.go`
- [x] 创建 `pkg/swagger/schema_builder_test.go`
- [x] 编写单元测试用例
- [x] 编写集成测试用例
- [ ] 验证测试覆盖率 > 80%

---

## 3. 文件输出模块实现

### 3.1 创建文件输出模块基础结构
- [x] 创建 `pkg/output/` 目录
- [x] 创建 `pkg/output/writer.go` 文件写入器
- [x] 创建 `pkg/output/formatter.go` 格式转换器
- [x] 定义 Writer 接口

### 3.2 实现文件写入
- [x] 实现 Swagger 文档写入
- [x] 实现配置文件写入
- [x] 实现 README 生成
- [x] 实现目录创建
- [x] 实现文件覆盖处理

### 3.3 实现格式转换
- [x] 实现 JSON 格式化
- [x] 实现 YAML 格式化
- [x] 实现缩进和美化
- [x] 实现验证

### 3.4 编写文件输出测试
- [ ] 创建 `pkg/output/writer_test.go`
- [ ] 创建 `pkg/output/formatter_test.go`
- [ ] 编写单元测试用例
- [ ] 编写集成测试用例
- [ ] 测试覆盖率 > 80%

---

## 4. CLI init 命令完整实现

### 4.1 扩展 init 命令
- [x] 添加 -p/--path 参数
- [x] 添加 -o/--output 参数
- [x] 添加 -t/--title 参数
- [x] 添加 -v/--version 参数
- [x] 添加 -d/--description 参数
- [x] 添加 -f/--format 参数

### 4.2 实现参数验证
- [x] 验证必需参数
- [x] 验证参数格式
- [x] 验证路径有效性
- [x] 提供清晰的错误提示

### 4.3 实现初始化流程
- [x] 创建解析器
- [x] 执行项目解析
- [x] 生成 Swagger 文档
- [x] 写入输出文件
- [x] 生成配置文件
- [x] 提供进度反馈

### 4.4 实现错误处理
- [x] 处理参数错误
- [x] 处理文件错误
- [x] 处理解析错误
- [x] 处理写入错误
- [x] 提供恢复建议

### 4.5 编写 init 命令测试
- [x] 创建 `cmd/swag-gen/init_test.go`
- [x] 编写单元测试用例
- [x] 编写集成测试用例
- [x] 测试各种参数组合
- [x] 测试错误情况

---

## 5. 集成测试和文档

### 5.1 编写集成测试
- [x] 创建 `tests/integration/parser_integration_test.go`
- [x] 创建 `tests/integration/swagger_integration_test.go`
- [x] 创建 `tests/integration/init_command_integration_test.go`
- [x] 测试完整的初始化流程
- [ ] 测试大型项目处理（1000+ 文件）
- [ ] 测试性能指标

### 5.2 创建测试数据
- [x] 创建示例 Go 项目
- [x] 创建示例 API 文件
- [ ] 创建边界情况测试数据
- [ ] 创建大型项目测试数据

### 5.3 编写文档
- [ ] 编写 API 文档
- [ ] 编写使用示例
- [ ] 编写故障排除指南
- [ ] 编写性能指标文档

### 5.4 性能测试
- [ ] 测试文件解析性能
- [ ] 测试文档生成性能
- [ ] 测试内存使用
- [ ] 测试并发处理

### 5.5 代码审查和优化
- [ ] 代码审查
- [ ] 性能优化
- [ ] 错误处理优化
- [ ] 日志优化

---

## 任务依赖关系

```
1.1 (基础结构)
  ↓
1.2 (AST 解析) → 1.3 (注释解析) → 1.4 (信息提取) → 1.5 (测试)
  ↓
2.1 (基础结构)
  ↓
2.2 (文档构建) → 2.3 (Schema 生成) → 2.4 (格式转换) → 2.5 (测试)
  ↓
3.1 (基础结构)
  ↓
3.2 (文件写入) → 3.3 (格式转换) → 3.4 (测试)
  ↓
4.1 (扩展命令) → 4.2 (参数验证) → 4.3 (初始化流程) → 4.4 (错误处理) → 4.5 (测试)
  ↓
5.1 (集成测试) → 5.2 (测试数据) → 5.3 (文档) → 5.4 (性能测试) → 5.5 (优化)
```

---

## 时间估计

| 任务 | 子任务数 | 预计时间 |
|------|---------|---------|
| 1. 代码解析模块 | 5 | 3 天 |
| 2. Swagger 生成模块 | 5 | 2 天 |
| 3. 文件输出模块 | 4 | 1.5 天 |
| 4. CLI init 命令 | 5 | 1.5 天 |
| 5. 集成测试和文档 | 5 | 2 天 |
| **总计** | **18** | **10 天** |

---

## 验收标准

### 功能完成
- [ ] 所有 18 个子任务完成
- [ ] 所有功能实现完成
- [ ] 所有功能测试通过

### 代码质量
- [ ] 代码遵循规范
- [ ] 单元测试覆盖率 > 80%
- [ ] 集成测试覆盖率完整
- [ ] 没有 lint 错误

### 性能指标
- [ ] 解析 1000 个文件 < 5 秒
- [ ] 生成 Swagger 文档 < 1 秒
- [ ] 内存使用 < 100MB
- [ ] 支持大型项目

### 文档完整
- [ ] API 文档完整
- [ ] 使用示例完整
- [ ] 故障排除指南完整
- [ ] 性能指标文档完整

---

## 相关文档

- [需求文档](./requirements.md)
- [设计文档](./design.md)
- [代码规范](../../steering/code-standards.md)
- [API 设计](../../steering/api-design.md)
- [技术栈](../../steering/tech.md)

---

## 进度跟踪

### 完成情况
- 总任务数: 18
- 已完成: 13
- 进行中: 0
- 未开始: 5
- 完成率: 72.2%

### 最后更新
- 日期: 2026-02-03
- 状态: 大部分核心功能已实现，需要完善参数/响应解析、编写输出模块测试、完成集成测试和文档
- 下一步: 
  1. 完善 1.4 参数和响应信息提取
  2. 编写 3.4 文件输出模块测试
  3. 完成 5.1-5.5 集成测试和文档工作

